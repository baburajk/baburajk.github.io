<!DOCTYPE html>
<html lang="en">
<head>  
	<meta charset="utf-8">
	<title>baburajk.github.io</title>
 
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="path/to/image.jpg">
 
<!-- build:css -->
<link rel="stylesheet" href="css/libs/bootstrap.min.css">
<link rel="stylesheet" href="css/libs/font-awesome.min.css">
<link rel="stylesheet" href="css/libs/animate.min.css">
<link rel="stylesheet" href="css/libs/slick.css">
<link rel="stylesheet" href="css/libs/magnific-popup.css">

<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/media.css">
<!-- endbuild -->
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#000">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#000">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#000">
	<!-- <style>body { opacity:s 0; overflow-x: hidden; } html { background-color: #fff; }</style> -->
</head>
<body data-spy="scroll" data-target=".navbar" data-offset="50" class="loaded" link="blue">

	
<div class="site-content">
	<!-- Naviigation -->
	<div class="navbar-wrap">
		<div class="navbar">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<nav class="navbar-menu">
							<div class="navbar-header">
								<button class="collapsed navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-example-js-navbar-scrollspy">
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
							</div>
							 
							<div class="navbar-full">
								<div class="collapse bs-example-js-navbar-scrollspy">
									<ul class="nav navbar-nav">
										<li style="display: none;"><a></a></li>
										<li><a href="http://www.linkedin.com/in/baburajkallarakkal">About Me</a></li>
										<li><a href="http://padmavyuha.blogspot.com/">Blog</a></li>
										<li><a href="https://sourceforge.net/projects/oraclerman/">Projects</a></li>
										<li><a href="https://hub.docker.com/u/baburaj/">Docker</a></li>
										<li><a href="mailto:raj.anju@gmail.com">Contact Me</a></li>
										<li>
										</li>
									</ul>
									<!-- btn -->
									<div class="nav-button main-button">
										<a href="#" class="btn btn-nav btn-block" role="button">
											Site is in Beta!
										</a>
									</div>
									<!-- btn -->
								</div>
							</div>
						</nav>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Naviigation -->
	

<!-- Header -->
	<div class="menu-sticky"></div>
 
	<!-- Screen-one -->
	<div class="screen-one">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="screen-one-title">

						<h2> Looking deeper into the Network Namespaces to understand how docker containers communicates.  </h2>
					</div>
				</div>
			</div>
		</div>
	 
		<div class="container">
 						<div class="screen-one-item-container">
							<h3>  Network NS Diagram  </h3>
 
							 <img src="./imgs/namespace-v2.svg" width="800" height="800"  alt="Network Configuration">   
							<p> #Simulate docker interpod communication using network namespaces.							</p>
							<p> There are lot of nice articles explaining how the Network Namespaces works and how Docker Containerization makes use of the network namespaces   
								for inter pod communications. To get a practical sense of how this works, two network namespaces was created on a KVM Guest VM. The VM used already has a docker daemon
								
								Running and instead of cleaning those up, I decided to use the same to see if those IP Table rules created by docker would create any issue, if so how and also to learn and use those rules
								as a reference point while setting these up.
								
								Logical diagram represents a quick high level over view of the overall configuration.
								
								A quick recap from the web, a network namespace is logically another copy of the network stack, with its  own routes, firewall rules, and network devices. y default a process inherits its network namespace from its parent. Initially all the processes share the same default network namespace from the init process.
								

							</p>
<pre>
	 

</pre>
						</div>
 
 						 
						<div class="screen-one-item-container">
							<h3> Default Configurations </h3>
							<p> 
								What does the defaults looks like before any changes were made! The default route to 192.168.122.0/24 is the one for the Guest VM to communicate to the hypervisor network and 172.17.0.0/16  is the one defined for docker daemon. Docker daemon , corresponding routes etc. was created for all the guest VM’s and for the purpose of this experiment , though I really don’t need them - decided to leave it out for two reasons. a) I can use the “iptable" rules created by docker itself as a reference b) If these rules by any reasons interfere that will result in more of a learning experience and go bit more deeper..
								
							</p>
							<p> </p>

<pre>

	

[root@rhel8b ~]# ip route show
default via 192.168.122.1 dev enp1s0 proto dhcp metric 100
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown
192.168.122.0/24 dev enp1s0 proto kernel scope link src 192.168.122.130 metric 100

[root@rhel8b ~]# ip addr show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:01:1a:b3 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.130/24 brd 192.168.122.255 scope global dynamic noprefixroute enp1s0
       valid_lft 3284sec preferred_lft 3284sec
    inet6 2001:db8:ca2:3:1::37/128 scope global dynamic noprefixroute
       valid_lft 2888sec preferred_lft 2888sec
    inet6 fe80::b6c6:db5e:4ae7:956a/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default
    link/ether 02:42:67:e9:9c:2a brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever



</pre>
						</div>
 
  						<div class="screen-one-item-container">
							<h3> Namespaces and VETH Pairs </h3>
							<p> Sesearch can be used to check the selinux policies, for eg. checking a rule and how the transition works is as below. <br>

							  <br>
						</p>
						<p> </p>

<pre>
[root@rhce5 data]# sesearch -T -s initrc_t -t httpd_exec_t
Found 1 semantic te rules:
   type_transition initrc_t httpd_exec_t : process httpd_t;


[root@server1 ~]# sesearch --allow --source httpd_t --target httpd_sys_content_t --class dir
Found 16 semantic av rules:
   allow httpd_t httpd_sys_content_t : dir { ioctl read getattr lock search open } ;
   
</pre>
 
						</div>
 
  	<div class="screen-one-item-container">
		<h3> ausearch </h3>
			<p>  ausearch can be used to dig into the logs. Prior to checking logs, install and run setroubleshootd <br> </p>
			<p> </p>

<pre>

#Start setroubleshoot daemon.
setroubleshootd

#ausearch options

ausearch -x httpd 
ausearch -m avc --start today

#Run sealert obtained from the audit.log to obtain additional information on the alert.

[root@lab125a ~]# sealert -l cd9b7da6-cb08-43ae-81e0-dbd7dd928036
SELinux is preventing /usr/sbin/sshd from name_connect access on the tcp_socket port 113.


</pre>
	</div>
 
 

	<!-- Contact -->
<a class="anchor" id="contact"></a>

<section class="contact">
		<div class="contact-wrap">
			<div class="container">
				<div class="row">
					<div class="col-md-12 __web-inspector-hide-shortcut__">
						<div class="contact-title">
							<h2></h2>
							<p> 
								<br class="disable"></p>
						</div>
						<!-- /.contact-title -->
					</div>
					<!-- /.col-md-12 -->
					
					<!-- /.col-md-10 -->
				</div>
				<!-- /.row -->
			</div>
			<!-- /.container -->
		</div>
		<!-- /.directions-wrap -->
	</section>

</div>
<!-- Site content -->

<!-- Footer -->
<a class="anchor" id="footer"></a>
<footer class="footer" style="background-image: url(img/footer-bg.jpg); background-position:center; background-size: cover; background-repeat:no-repeat;">
	<div class="footer-wrap">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="footer-title">
						<h2>www.intercloudzone.com</h2>
						<ul class="footer-icons">
						<script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
						<script type="IN/Share" data-url="http://www.intercloudzone.com/selinux.html"></script>
						</ul>
						<p> </p>
					</div>
					<!-- /.footer-title -->
				</div>
				<!-- /.col-md-12 -->
			</div>
			<!-- /.row -->
		</div>
		<!-- /.container -->
	</div>
	<!-- /.directions-wrap -->
</footer>
<!-- Footer -->



<!-- links -->
<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyDDuC8pr6YqiBr9wqfhNIJ56AqwzWKhiQo"></script>
<!-- build:js -->

 

<script src="js/libs/jquery.min.js"></script>
<script type="text/javascript" src="js/libs/bootstrap.min.js"></script>
<script type="text/javascript" src="js/libs/waypoints.min.js"></script>
<script type="text/javascript" src="js/libs/slick.min.js"></script>
<script type="text/javascript" src="js/libs/magnific-popup.min.js"></script>

<script type="text/javascript" src="js/common.js"></script>
<!-- endbuild -->
<!-- links -->
</body>
</html>
